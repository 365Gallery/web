<!DOCTYPE html>
<html lang="zxx">
<head>
	<title>365 Gallery</title>
	<meta charset="UTF-8">
	<meta name="description" content="Boto Photo Studio HTML Template">
	<meta name="keywords" content="photo, html">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Stylesheets -->
	<link rel="stylesheet" href="css/bootstrap.min.css"/>
	<link rel="stylesheet" href="css/font-awesome.min.css"/>
	<link rel="stylesheet" href="css/slicknav.min.css"/>

	<!-- Main Stylesheets -->
	<link rel="stylesheet" href="css/style.css"/>


	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

</head>
<body>
	<!-- Page Preloder -->
	<div id="preloder">
		<div class="loader"></div>
	</div>

	<!-- Header Section -->
	<header class="header">
		<div class="container-fluid">
			<div class="row">
				<div class="col-sm-4 col-md-3 order-2 order-sm-1">
				</div>
				<div class="col-sm-4 col-md-6 order-1  order-md-2 text-center">
					<a href="./index.html" class="site-logo">
						<img src="img/logo.png" alt="">
					</a>
				</div>
				<div class="col-sm-4 col-md-3 order-3 order-sm-3">
				</div>
			</div>
			<nav class="main__menu">
				<ul class="nav__menu">
					<li><a href="./index.html" class="menu--active">Home</a></li>
					<li><a href="#" onclick="setChildValue(0)">Exhibition</a>
						<ul class="sub__menu">
					<li><a href="#" onclick="setChildValue(0)">Romanticism</a>
					<ul class="sub2__menu">
						<li><a href="#" onclick="setChildValue(0)">William Turner</a></li>
					</ul></li>
					<li><a href="#" onclick="setChildValue(2)">Impressionism</a>
					<ul class="sub2__menu">
						<!--
						<li><a href="#" onclick="setChildValue(1)">Van Gogh</a></li>
					-->
						<li><a href="#" onclick="setChildValue(2)">Seurat</a></li>
						<li><a href="#" onclick="setChildValue(3)">Claude Monet</a></li>
						<li><a href="#" onclick="setChildValue(4)">Leonid Afremov</a></li>
						<li><a href="#" onclick="setChildValue(5)">Katsushika Hokusai</a></li>
					</ul></li>
					<li><a href="#" onclick="setChildValue(6)">Fauvism</a>
					<ul class="sub2__menu">
						<li><a href="#" onclick="setChildValue(6)">Henri Matisse</a></li>
						<li><a href="#" onclick="setChildValue(7)">Andre Derain</a></li>
					</ul></li>
					<li><a href="#" onclick="setChildValue(8)">Cubism</a>
					<ul class="sub2__menu">
						<li><a href="#" onclick="setChildValue(8)">Pablo Picasso</a></li>
						<li><a href="#" onclick="setChildValue(9)">Fernand Leger</a></li>
						<li><a href="#" onclick="setChildValue(10)">Francis Picabia</a></li>
					</ul></li>
					<li><a href="#" onclick="setChildValue(11)">Abstractionism</a>
					<ul class="sub2__menu">
						<li><a href="#" onclick="setChildValue(11)">Robert Delaunay</a></li>
						<li><a href="#" onclick="setChildValue(12)">Pieter Mondrian</a></li>
					</ul></li>
					<li><a href="#" onclick="setChildValue(13)">Expressionism</a>
					<ul class="sub2__menu">
						<li><a href="#" onclick="setChildValue(13)">Edvard Munch</a></li>
						<li><a href="#" onclick="setChildValue(14)">Gustav Klimt</a></li>
					</ul></li>
					<li><a href="#" onclick="setChildValue(15)">Futurism</a>
					<ul class="sub2__menu">
						<li><a href="#" onclick="setChildValue(15)">Umberto Boccioni</a></li>
						<li><a href="#" onclick="setChildValue(16)">Giacomo Balla</a></li>
					</ul></li>
					<li><a href="#" onclick="setChildValue(17)">Surrealism</a>
					<ul class="sub2__menu">
						<li><a href="#" onclick="setChildValue(17)">Joan Miro</a></li>
						<li><a href="#" onclick="setChildValue(18)">Marc Chagall</a></li>
					</ul></li>
					<li><a href="#" onclick="setChildValue(19)">Pop Art</a>
					<ul class="sub2__menu">
						<li><a href="#" onclick="setChildValue(19)">Roy Lichtenstein</a></li>
						<li><a href="#" onclick="setChildValue(20)">Keith Haring</a></li>
					</ul></li>		
					</ul></li>
					<li><a href="./mygallery.html">My Gallery</a></li>
				</ul>
			</nav>
		</div>
	</header>
	<!-- Header Section end -->

	<!-- About Page -->
	<section class="about__page">
		<div class="move-btn-pic">
			<button onClick="setChildValue_pic()">이미지 전환</button>
			<button id="btnSave" onclick="downloadImg('http://34.64.152.92:8000/media/output.jpeg');">캡처</button>
		</div>
		<div class="cam-box">
			<div id="mycam" class="input-cam" autoplay>
			</div>
			<div class = "output-cam">
				<img src="http://34.64.152.92:8000/media/output.jpeg" name="camReload" alt=""/>
			</div>
		</div>
		<div class="cam-description">
			<div class="row">
				<div class="art_description">
				</div>
			</div>
		</div>
	</section>
	<!-- About Page end -->


	<!-- Search Begin -->
	<div class="search-model">
		<div class="h-100 d-flex align-items-center justify-content-center">
			<div class="search-close-switch">+</div>
			<form class="search-model-form">
				<input type="text" id="search-input" placeholder="Search here.....">
			</form>
		</div>
	</div>
	<!-- Search End -->

	<!--====== Javascripts & Jquery ======-->
	<script src="js/vendor/jquery-3.2.1.min.js"></script>
	<script src="js/jquery.slicknav.min.js"></script>
	<script src="js/slick.min.js"></script>
	<script src="js/main.js"></script>
	<script src="js/webcam.js"></script>
	<script src="https://cdn.rawgit.com/eligrey/FileSaver.js/5ed507ef8aa53d8ecfea96d96bc7214cd2476fd2/FileSaver.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.js"></script>

	<!-- Script: Cam -->
	<script>
	function dataURItoBlob(dataURI) {
	    // convert base64/URLEncoded data component to raw binary data held in a string
	    var byteString;
	    if (dataURI.split(',')[0].indexOf('base64') >= 0)
	        byteString = atob(dataURI.split(',')[1]);
	    else
	        byteString = unescape(dataURI.split(',')[1]);

	    // separate out the mime component
	    var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];

	    // write the bytes of the string to a typed array
	    var ia = new Uint8Array(byteString.length);
	    for (var i = 0; i < byteString.length; i++) {
	        ia[i] = byteString.charCodeAt(i);
	    }

	    return new Blob([ia], {type:mimeString});
	}

	function uploadSnap(img_src){
		var num;

		num = location.href.substr(location.href.lastIndexOf('=') + 1);
		 $('.art_description').empty();
		 num = num - '0'

		imageBlob = dataURItoBlob(img_src);
		var data = new FormData();
		data.append('file', imageBlob, "webcam.jpeg");

		var serverURL = "http://34.64.152.92:8000/api/v1/images/";

		switch (num){
			case 0:
				serverURL = serverURL + "?model=wreck.ckpt&";
				break;
			case 4:
				serverURL = serverURL + "?model=rain_princess.ckpt&";
				break;
			case 5:
				serverURL = serverURL + "?model=wave.ckpt&";
				break;
			case 8:
				serverURL = serverURL + "?model=la_muse.ckpt&";
				break;
			case 9:
				break;
			case 10:
				serverURL = serverURL + "?model=udnie.ckpt&";
				break;
			case 11:
				break;
			case 12:
				break;
			case 13:
				serverURL = serverURL + "?model=scream.ckpt&";
				break;
		}

		serverURL = serverURL + "async=true"

		$.ajax({
	        type: "POST",
	        enctype: 'multipart/form-data',
	        url: serverURL,
	        data: data,
	        processData: false,
	        contentType: false,
	        cache: false,
	        timeout: 600000,
	    });
	}

	function take_snapshot() {
		Webcam.snap(function(data_uri) {
			uploadSnap(data_uri);
		});
	}

	function ShowCam(){
		Webcam.set({
		width: 500,
		height: 400,
		image_format: 'jpeg',
		jpeg_quality: 30
		});
		Webcam.attach('#mycam');
	}
		window.onload = ShowCam;

		setInterval(function(){
	    	if (Webcam.loaded) {
	    		take_snapshot();
	    	}
		}, 300);

		setInterval(function(){
	    	timeTmp = new Date().getTime();
	    	timeTmp = "?"+ timeTmp;

	    	var target='camReload';
	    	newImage = document.images[target].src;

	    	idx = newImage.indexOf("?", 0);

	    	if(idx > 0){
	    		newImage = newImage.substr(0, idx);
	    	}
	    	document.images[target].src = newImage+timeTmp;
		}, 150);
	</script>

	<!-- Script: img parameter -->
	<script>
	function setChildValue(index) {
		window.location.href = "exhibition_pic.html?index=" + index;
	}

	function setChildValue_pic() {
		var num = location.href.substr(location.href.lastIndexOf('=') + 1);
		window.location.href = "exhibition_pic.html?index=" + num;
	}
	</script>

	<!-- Script: Download Image -->
	<script>
		function dataURLtoBlob(dataurl) {
		  var arr = dataurl.split(','),
		    mime = arr[0].match(/:(.*?);/)[1],
		    bstr = atob(arr[1]),
		    n = bstr.length,
		    u8arr = new Uint8Array(n);
		  while (n--) {
		    u8arr[n] = bstr.charCodeAt(n);
		  }
		  return new Blob([u8arr], {
		    type: mime
		  });
		}

		function downloadImg(imgSrc) {
		  var image = new Image();
		  image.crossOrigin = "anonymous";
		  image.src = imgSrc;
		  var fileName = image.src.split("/").pop();
		  image.onload = function() {
		    var canvas = document.createElement('canvas');
		    canvas.width = this.width;
		    canvas.height = this.height;
		    canvas.getContext('2d').drawImage(this, 0, 0);
		    if (typeof window.navigator.msSaveBlob !== 'undefined') {
		      window.navigator.msSaveBlob(dataURLtoBlob(canvas.toDataURL()), fileName);
		    } else {
		      var link = document.createElement('a');
		      link.href = canvas.toDataURL();
		      link.download = '365Gallery';
		      link.click();
		    }
		  };
		}
	</script>
	</body>
</html>