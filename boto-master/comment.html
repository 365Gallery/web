<!DOCTYPE html>
<html lang="zxx">
<head>
	<title>365 Gallery</title>
	<meta charset="UTF-8">
	<meta name="description" content="Boto Photo Studio HTML Template">
	<meta name="keywords" content="photo, html">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Stylesheets -->
	<link rel="stylesheet" href="css/bootstrap.min.css"/>
	<link rel="stylesheet" href="css/font-awesome.min.css"/>
	<link rel="stylesheet" href="css/slicknav.min.css"/>
	<link rel="stylesheet" href="css/fresco.css"/>

	<!-- Main Stylesheets -->
	<link rel="stylesheet" href="css/style.css"/>


	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

</head>
<body>
	<!-- Page Preloder -->
	<div id="preloder">
		<div class="loader"></div>
	</div>

	<!-- Header Section -->
	<header class="header">
		<div class="container-fluid">
			<div class="row">
				<div class="col-sm-4 col-md-3 order-2 order-sm-1">
				</div>
				<div class="col-sm-4 col-md-6 order-1  order-md-2 text-center">
					<a href="./index.html" class="site-logo">
						<img src="img/logo.png" alt="">
					</a>
				</div>
				<div class="col-sm-4 col-md-3 order-3 order-sm-3">
				</div>
			</div>
			<nav class="main__menu">
				<ul class="nav__menu">
					<li><a href="./index.html" class="menu--active">Home</a></li>
					<li><a href="#" onclick="setChildValue(0)">Exhibition</a>
						<ul class="sub__menu">
					<li><a href="#" onclick="setChildValue(0)">Romanticism</a>
					<ul class="sub2__menu">
						<li><a href="#" onclick="setChildValue(0)">William Turner</a></li>
					</ul></li>
					<li><a href="#" onclick="setChildValue(2)">Impressionism</a>
					<ul class="sub2__menu">
						<!--
						<li><a href="#" onclick="setChildValue(1)">Van Gogh</a></li>
					-->
						<li><a href="#" onclick="setChildValue(2)">Seurat</a></li>
						<li><a href="#" onclick="setChildValue(3)">Claude Monet</a></li>
						<li><a href="#" onclick="setChildValue(4)">Leonid Afremov</a></li>
						<li><a href="#" onclick="setChildValue(5)">Katsushika Hokusai</a></li>
					</ul></li>
					<li><a href="#" onclick="setChildValue(6)">Fauvism</a>
					<ul class="sub2__menu">
						<li><a href="#" onclick="setChildValue(6)">Henri Matisse</a></li>
						<li><a href="#" onclick="setChildValue(7)">Andre Derain</a></li>
					</ul></li>
					<li><a href="#" onclick="setChildValue(8)">Cubism</a>
					<ul class="sub2__menu">
						<li><a href="#" onclick="setChildValue(8)">Pablo Picasso</a></li>
						<li><a href="#" onclick="setChildValue(9)">Fernand Leger</a></li>
						<li><a href="#" onclick="setChildValue(10)">Francis Picabia</a></li>
					</ul></li>
					<li><a href="#" onclick="setChildValue(11)">Abstractionism</a>
					<ul class="sub2__menu">
						<li><a href="#" onclick="setChildValue(11)">Robert Delaunay</a></li>
						<li><a href="#" onclick="setChildValue(12)">Pieter Mondrian</a></li>
					</ul></li>
					<li><a href="#" onclick="setChildValue(13)">Expressionism</a>
					<ul class="sub2__menu">
						<li><a href="#" onclick="setChildValue(13)">Edvard Munch</a></li>
						<li><a href="#" onclick="setChildValue(14)">Gustav Klimt</a></li>
					</ul></li>
					<li><a href="#" onclick="setChildValue(15)">Futurism</a>
					<ul class="sub2__menu">
						<li><a href="#" onclick="setChildValue(15)">Umberto Boccioni</a></li>
						<li><a href="#" onclick="setChildValue(16)">Giacomo Balla</a></li>
					</ul></li>
					<li><a href="#" onclick="setChildValue(17)">Surrealism</a>
					<ul class="sub2__menu">
						<li><a href="#" onclick="setChildValue(17)">Joan Miro</a></li>
						<li><a href="#" onclick="setChildValue(18)">Marc Chagall</a></li>
					</ul></li>
					<li><a href="#" onclick="setChildValue(19)">Pop Art</a>
					<ul class="sub2__menu">
						<li><a href="#" onclick="setChildValue(19)">Roy Lichtenstein</a></li>
						<li><a href="#" onclick="setChildValue(20)">Keith Haring</a></li>
					</ul></li>		
					</ul></li>
					<li><a href="./mygallery.html">My Gallery</a></li>
				</ul>
			</nav>
		</div>
	</header>
	<!-- Header Section end -->

	<!-- About Page -->
	<section class="about__page">
		<div class="comment__page">
			<div class="image_section">
				<img id="comment_img" src="">
			</div>
			<div class="button_section" >
				<button onclick="location.href='mygallery.html'">갤러리로 이동</button>
			</div>
			<div class="input_writer">
				<textarea id="comment_writer" rows=1 placeholder="작성자"></textarea>
			</div>
			<div class="input_comment">
				<textarea id="new_comment" rows=2 placeholder="Comment를 입력하세요"></textarea>
				<button type='button' id="commentBtn" onclick="commentPost();">등록</button>
			</div>
			<div id="comments" class="view_comment">
				<div class="comment-row">
					<div class="comment-writer"></div>
					<div class="comment-content"></div>
				</div>
			</div>
		</div>
	</section>
	<!-- About Page end -->

	<!-- Search Begin -->
	<div class="search-model">
		<div class="h-100 d-flex align-items-center justify-content-center">
			<div class="search-close-switch">+</div>
			<form class="search-model-form">
				<input type="text" id="search-input" placeholder="Search here.....">
			</form>
		</div>
	</div>
	<!-- Search End -->

	<!--====== Javascripts & Jquery ======-->
	<script src="js/vendor/jquery-3.2.1.min.js"></script>
	<script src="js/jquery.slicknav.min.js"></script>
	<script src="js/slick.min.js"></script>
	<script src="js/fresco.min.js"></script>
	<script src="js/main.js"></script>

	<!-- Script: Gallery script-->
	<script>
	// comment: data load
	function dataLoad(){
		$.getJSON("http://34.64.152.92:8000/api/v1/gallery/", function(result) {
			var i = 0;
			while (result.data[i]){
				if (result.data[i].pk == getPK()){
					document.getElementById("comment_img").src = result.data[i].file;
					if (result.data[i].tag != null){
						$('.image_section').append('<p>#'+ result.data[i].tag.name + '</p>');
					}
					else {
						$('.image_section').append('<p>#Upload by User</p>');
					}

					if (result.data[i].comments[0]){
						var j = 0;
						while (result.data[i].comments[j]){
							var writer = result.data[i].comments[j].comment.writer;
							var text = result.data[i].comments[j].comment.text;
							loadComment(writer, text);
							j++;
						}
					}
					else {
						$('.view_comment').append('<p>등록된 Comment가 없습니다</p>');
					}
					break;
				}
				i++;
			}
		});
	}

	// comment: load comment
	function loadComment(writer, comment) {
		var writer_div = document.createElement('div');
		writer_div.classList.add('comment-writer');
		writer_div.innerText = writer;

		var content_div = document.createElement('div');
		content_div.classList.add('comment-content');
		content_div.innerText = comment;

		var comment_div = document.createElement('div');
		comment_div.classList.add('comment-row');
		comment_div.appendChild(writer_div);
		comment_div.appendChild(content_div);
		document.getElementById('comments').appendChild(comment_div);
	}

	// comment: post comment by ajax
	function commentPost() {
		var writer = $('#comment_writer').val();
		var content = $('#new_comment').val();

		if (writer == ''){
			writer = '익명';
		}
		if (content == ''){
			alert('Comment를 입력하세요');
		}
		else {
			var data = new FormData();
			data.append('writer', writer);
			data.append('text', content);
			data.append('photo_pk', getPK());

			var serverURL = "http://34.64.152.92:8000/api/v1/comment/";

			$.ajax({
		        type: "POST",
		        url: serverURL,
		        data: data,
		        dataType: 'json',
		        processData: false,
		        contentType: false,
		        cache: false,
		        timeout: 10000,
		        success: function() {
		        	location.reload();
		        },
		        error: function() {
		        	alert('Upload failed');
		        }
			    });
		}
	}

	// comment: exhibition menu parameter
	function setChildValue(index) {
		window.location.href = "exhibition_pic.html?index=" + index;
	}

	// comment: get pk num
	function getPK(){
		var pk = location.href.substr(location.href.lastIndexOf('=') + 1);

		return pk;
	}

	$(document).ready(function() {
		dataLoad();
	})
	</script>
	</body>
</html>