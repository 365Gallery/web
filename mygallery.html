<!DOCTYPE html>
<html lang="zxx">
<head>
	<title>365 Gallery</title>
	<meta charset="UTF-8">
	<meta name="description" content="Boto Photo Studio HTML Template">
	<meta name="keywords" content="photo, html">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Stylesheets -->
	<link rel="stylesheet" href="css/bootstrap.min.css"/>
	<link rel="stylesheet" href="css/font-awesome.min.css"/>
	<link rel="stylesheet" href="css/slicknav.min.css"/>
	<link rel="stylesheet" href="css/fresco.css"/>

	<!-- Main Stylesheets -->
	<link rel="stylesheet" href="css/style.css"/>


	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

</head>
<body>
	<!-- Page Preloder -->
	<div id="preloder">
		<div class="loader"></div>
	</div>

	<!-- Header Section -->
	<header class="header">
		<div class="container-fluid">
			<div class="row">
				<div class="col-sm-4 col-md-3 order-2 order-sm-1">
				</div>
				<div class="col-sm-4 col-md-6 order-1  order-md-2 text-center">
					<a href="./index.html" class="site-logo">
						<img src="img/logo.png" alt="">
					</a>
				</div>
				<div class="col-sm-4 col-md-3 order-3 order-sm-3">
				</div>
			</div>
			<nav class="main__menu">
				<ul class="nav__menu">
					<li><a href="./index.html" class="menu--active">Home</a></li>
					<li><a href="#" onclick="setChildValue(0)">Exhibition</a>
						<ul class="sub__menu">
					<li><a href="#" onclick="setChildValue(0)">Romanticism</a>
					<ul class="sub2__menu">
						<li><a href="#" onclick="setChildValue(0)">William Turner</a></li>
					</ul></li>
					<li><a href="#" onclick="setChildValue(2)">Impressionism</a>
					<ul class="sub2__menu">
						<!--
						<li><a href="#" onclick="setChildValue(1)">Van Gogh</a></li>
					-->
						<li><a href="#" onclick="setChildValue(2)">Seurat</a></li>
						<li><a href="#" onclick="setChildValue(3)">Claude Monet</a></li>
						<li><a href="#" onclick="setChildValue(4)">Leonid Afremov</a></li>
						<li><a href="#" onclick="setChildValue(5)">Katsushika Hokusai</a></li>
					</ul></li>
					<li><a href="#" onclick="setChildValue(6)">Fauvism</a>
					<ul class="sub2__menu">
						<li><a href="#" onclick="setChildValue(6)">Henri Matisse</a></li>
						<li><a href="#" onclick="setChildValue(7)">Andre Derain</a></li>
					</ul></li>
					<li><a href="#" onclick="setChildValue(8)">Cubism</a>
					<ul class="sub2__menu">
						<li><a href="#" onclick="setChildValue(8)">Pablo Picasso</a></li>
						<li><a href="#" onclick="setChildValue(9)">Fernand Leger</a></li>
						<li><a href="#" onclick="setChildValue(10)">Francis Picabia</a></li>
					</ul></li>
					<li><a href="#" onclick="setChildValue(11)">Abstractionism</a>
					<ul class="sub2__menu">
						<li><a href="#" onclick="setChildValue(11)">Robert Delaunay</a></li>
						<li><a href="#" onclick="setChildValue(12)">Pieter Mondrian</a></li>
					</ul></li>
					<li><a href="#" onclick="setChildValue(13)">Expressionism</a>
					<ul class="sub2__menu">
						<li><a href="#" onclick="setChildValue(13)">Edvard Munch</a></li>
						<li><a href="#" onclick="setChildValue(14)">Gustav Klimt</a></li>
					</ul></li>
					<li><a href="#" onclick="setChildValue(15)">Futurism</a>
					<ul class="sub2__menu">
						<li><a href="#" onclick="setChildValue(15)">Umberto Boccioni</a></li>
						<li><a href="#" onclick="setChildValue(16)">Giacomo Balla</a></li>
					</ul></li>
					<li><a href="#" onclick="setChildValue(17)">Surrealism</a>
					<ul class="sub2__menu">
						<li><a href="#" onclick="setChildValue(17)">Joan Miro</a></li>
						<li><a href="#" onclick="setChildValue(18)">Marc Chagall</a></li>
					</ul></li>
					<li><a href="#" onclick="setChildValue(19)">Pop Art</a>
					<ul class="sub2__menu">
						<li><a href="#" onclick="setChildValue(19)">Roy Lichtenstein</a></li>
						<li><a href="#" onclick="setChildValue(20)">Keith Haring</a></li>
					</ul></li>		
					</ul></li>
					<li><a href="./mygallery.html">My Gallery</a></li>
				</ul>
			</nav>
		</div>
	</header>
	<!-- Header Section end -->

	<!-- About Page -->
	<div class="gallery__page">
		<div class="gallery__warp">
			<div class="filebox" style="display:none;">
				<form method="POST" enctype="multipart/form-data" id="uploadForm">
					<input class="upload-name" value="선택된 파일 없음" disabled="disabled" >
					<label for="ex_filename">파일 선택</label>
					<input type="file" id="ex_filename"  class="upload-hidden" accept="image/*"/>
					<button id='btnUpload'>추가</button>
					
				</form>
			</div>
				<div class='editbox'>
					<button id='btnDel' onclick='imgdelete();' style="display:none;">삭제</button>
					<button id='btnEdit' onclick='editmode()'>편집</button>
				</div>
				<div class="gallerybox">	
				<div class="row">
					<div class="imgGrid1">
					</div>
					<div class="imgGrid2">
					</div>
					<div class="imgGrid3">
					</div>
					<div class="imgGrid4">
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- About Page end -->

	<!-- Search Begin -->
	<div class="search-model">
		<div class="h-100 d-flex align-items-center justify-content-center">
			<div class="search-close-switch">+</div>
			<form class="search-model-form">
				<input type="text" id="search-input" placeholder="Search here.....">
			</form>
		</div>
	</div>
	<!-- Search End -->

	<!--====== Javascripts & Jquery ======-->
	<script src="js/vendor/jquery-3.2.1.min.js"></script>
	<script src="js/jquery.slicknav.min.js"></script>
	<script src="js/slick.min.js"></script>
	<script src="js/fresco.min.js"></script>
	<script src="js/main.js"></script>

	<!-- Script: Gallery script-->
	<script>
	// gallery: add
	$('#btnUpload').on('click', function(event) {
	    event.preventDefault();

	    var form = $('#uploadForm')[0][1].files[0];
	    var data = new FormData();
		data.append('file', form, form.name);

		var serverURL = "http://34.64.152.92:8000/api/v1/gallery/";
		
	    $.ajax({
	        type: "POST",
	        enctype: 'multipart/form-data',
	        url: serverURL,
	        data: data,
	        processData: false,
	        contentType: false,
	        cache: false,
	        timeout: 10000,
	        success: function(){
	        	location.reload();
	    	},
	    	error: function() {
	    		alert("Upload failed");
	    	}
	    });

	});

	// gallery: delete
	function imgdelete(){
		var checkObj = document.getElementsByName("images");
		var num = checkObj.length;
		var delURL;

		for (i = 0; i < num; i++){
			if (checkObj[i].checked == true){
				delURL = "http://34.64.152.92:8000/api/v1/gallery/" + checkObj[i].value + "/";
				$.ajax({
					url: delURL,
					method: "DELETE",
					success: function() {
						location.reload();
					},
					error: function() {
						alert("Delete failed");
					}
				})
			}
		}
	}

	// gallery: img load
	function galleryLoad(){
		$.getJSON("http://34.64.152.92:8000/api/v1/gallery/", function(result) {
			var i = 0;
			while (result['data'][i]){
				var gridName;
				if (i % 4 == 0)
					gridName = '.imgGrid1';
				else if (i % 4 == 1)
					gridName = '.imgGrid2';
				else if (i % 4 == 2)
					gridName = '.imgGrid3';
				else if (i % 4 == 3)
					gridName = '.imgGrid4';

				var prepend_data = '<input type="checkbox" class="imgCheck" name="images" value=' + result.data[i].pk + ' " style="display: none;"/><article class="image_list"><div class="galleryImg"> <a href="#" onclick="toCommentPage(' + result.data[i].pk + ')"><img src=' + result.data[i].file + ' alt=""></a></div><a class="image_tag" onclick="toCommentPage(' + result.data[i].pk + ')" id="image_tag_' + result.data[i].pk + '" href="#" >';
				if (result.data[i].tag != null)
					prepend_data += result.data[i].tag.name;
				else
					prepend_data += "Upload by User";
				prepend_data = prepend_data + '</a></article>';

				$(gridName).prepend(prepend_data);

				if (result.data[i].tag != null){
					var rgb = result.data[i].tag.color;
					var r = rgb[0] + rgb[1];
					r = parseInt(r, 16);
					var g = rgb[2] + rgb[3];
					g = parseInt(g, 16);
					var b = rgb[4] + rgb[5];
					b = parseInt(b, 16);
					var myrgba = 'rgba('+r+','+g+','+b+',0.4)';

					document.getElementById("image_tag_" + result.data[i].pk).style.backgroundColor = myrgba;
				}

				i++;
			}
		});
	}

	// gallery: mode change
	function editmode(){
		const btnElement = document.getElementById('btnEdit');
		var html;

		if (btnElement.innerHTML == '편집'){
			html = '완료';
			$('#btnDel').show();
			$('.imgCheck').show();
			$('.filebox').show();
		}
		else {
			html = '편집';
			$('#btnDel').hide();
			$('.imgCheck').hide();
			$('.filebox').hide();
		}

		btnElement.innerHTML = html;
	}

	// gallery: exhibition menu parameter
	function setChildValue(index) {
		window.location.href = "exhibition_pic.html?index=" + index;
	}

	// gallery: move to comment page
	function toCommentPage(pk){
		window.location.href = "comment.html?pk=" + pk;
	}

	var sel_file;

	// ready function
	$(document).ready(function(){ 
		var fileTarget = $('.filebox .upload-hidden'); 

		// file name connecting
		fileTarget.on('change', function(){
			if (window.FileReader){ 
				var filename = $(this)[0].files[0].name; 
			} 
			else {
				var filename = $(this).val().split('/').pop().split('\\').pop();
			} 
			$(this).siblings('.upload-name').val(filename);
		});

		// gallery data load
		galleryLoad();
	});
	</script>
	</body>
</html>